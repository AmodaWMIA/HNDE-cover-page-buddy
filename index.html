<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cover Page Generator</title>
<style>
  html, body {
    height: 100%;
    margin: 0;
    font-family:'Times New Roman', Times, serif;
    background: #4fc3f7;
    text-transform: uppercase;
  }

  .app {
    max-width: 980px;
    margin: 8px auto;
    padding: 8px;
  }

  /* Desktop: render as A4 box for PDF and print */
  .page {
    width: 210mm;
    height: 297mm;
    background: white;
    box-sizing: border-box;
    margin: auto;
    position: relative;
    overflow-wrap: break-word;
    font-family: 'Times New Roman', Times, serif;
    border: 1px solid #000;
  }

  .page-inner {
    position: absolute;
    left: 25mm;
    top: 10mm;
    right: 10mm;
    bottom: 10mm;
    border: 1px solid #000;
    padding: 4mm;
    box-sizing: border-box;
  }

  /* Blocks positioned inside page-inner */
  .top-right, .bottom-right {
    position: absolute;
    left: 50%;
    text-align: left;
    white-space: pre-line;
    transform: translateX(-50%); /* center horizontally */
  }

  .top-right {
    top: 5mm;
    font-size: 25px;
    line-height: 1.3;
    padding-bottom: 2mm;
  }

  .bottom-right {
    bottom: 5mm;
    font-size: 15px;
    line-height: 1.2;
  }

  /* Center title using per-line underlines (text-decoration) */
  .center-title {
    position: relative;
    left: 50%;
    transform: translate(-50%,-50%);
    top: calc(10mm + 90mm);
    font-size: 39px;
    text-align: center;
    line-height: 1.4;
    padding: 0 5mm;
    display: inline-block;
    width: auto;
    white-space: normal;
    box-sizing: border-box;
    text-decoration-line: underline;
    text-decoration-color: #000;
    text-decoration-style: solid;
    text-decoration-thickness: 3px;
    text-underline-offset: 8px;
    text-decoration-skip-ink: none;
  }

  .middle-left {
    position: absolute;
    left: 5mm;
    top: calc(10mm + 120mm);
    font-size: 15px;
    line-height: 1.2;
    white-space: pre-line;
  }

  .form {
    background: #fff;
    border-radius: 8px;
    padding: 12px;
    margin: 10px 0;
    box-shadow: 0 1px 4px rgba(0,0,0,0.08);
  }

  .form label {
    font-size: 14px;
    display:block;
    margin-top:8px;
  }

  .form input[type="text"], .form textarea, .form select, .form input[type="date"] {
    width:100%;
    padding:8px;
    box-sizing:border-box;
    font-family: 'Times New Roman', Times, serif;
    text-transform:uppercase;
    margin-top:6px;
    font-size:14px;
  }

  .btn{
    display:block;
    width:100%;
    padding:12px;
    margin-top:10px;
    background:#00e676;
    color:#222;
    border-radius:8px;
    font-size:16px;
    cursor: pointer;
    text-align: center;
  }

  .top-right td:last-child {
    text-align: left;
    padding-right: 2mm;
  }

  /* Mobile / small screens: flow layout so preview is readable and interactive */
  @media (max-width: 768px) {
    .page {
      width: 100%;
      height: auto;
      transform: none;
      margin: 0 auto 12px;
      padding: 8px 0;
    }

    /* make inner content flow vertically for mobile */
    .page-inner {
      position: relative;
      left: auto;
      top: auto;
      right: auto;
      bottom: auto;
      margin: 8px;
      padding: 10px;
      border: 1px solid #000;
      box-sizing: border-box;
    }

    .top-right {
      position: relative;
      left: auto;
      transform: none;
      text-align: center;
      border-bottom: 2px solid #000;
      padding-bottom: 6px;
      font-size: 18px;
      margin-bottom: 8px;
    }

    .center-title {
      position: relative;
      left: auto;
      transform: none;
      top: auto;
      margin: 12px auto;
      font-size: 26px;
      padding: 0 6mm;
      display: inline-block;
      width: auto;
      text-decoration-thickness: 2px;
      text-underline-offset: 6px;
    }

    .middle-left {
      position: relative;
      left: auto;
      top: auto;
      margin-top: 12px;
      font-size: 15px;
      white-space: pre-line;
    }

    .bottom-right {
      position: relative;
      left: auto;
      transform: none;
      text-align: center;
      margin-top: 10px;
      font-size: 14px;
      bottom: auto;
    }
  }

  /*
    Overrides used only while preparing the element for PDF export.
    We toggle "pdf-export" on <body> during export so responsive rules won't shrink/flow the A4 preview.
    The !important flags ensure these values win over the media query rules.
  */
  body.pdf-export .page {
    width: 210mm !important;
    height: 297mm !important;
    transform: none !important;
    margin: 0 auto !important;
  }
  body.pdf-export .page-inner {
    position: absolute !important;
    left: 25mm !important;
    top: 10mm !important;
    right: 10mm !important;
    bottom: 10mm !important;
  }
</style>
</head>
<body>
<div class="app">
  <h2>Cover Page Generator</h2>
  <div class="page" id="pagePreview">
    <div class="page-inner" id="pageInner">
      <div class="top-right" id="topRightBlock"></div>
      <div class="center-title" id="centerTitle"></div>
      <div class="middle-left" id="middleLeftBlock"></div>
      <div class="bottom-right" id="bottomRightBlock"></div>
    </div>
  </div>

  <div class="form" id="form">
    <label>Experiment No</label><input id="expNo" type="text">
    <label>Subject name</label><textarea id="subject"></textarea>
    <label>Subject code</label><input id="subjectCode" type="text">
    <label>Experiment title (main center)</label><input id="expTitle" type="text">
    <label>Instructed by</label><input id="instructor" type="text">
    <label>Group</label><input id="group" type="text">
    <label>Group members (one per line)</label><textarea id="members"></textarea>
    <label>Name</label><textarea id="name"></textarea>
    <label>Reg No</label><input id="regNo" type="text">
    <label>Course</label>
    <select id="course">
      <option>HNDE EE</option><option>HNDE ME</option><option>HNDE BSE</option><option>HNDE CE</option>
    </select>
    <label>Date of Ins</label><input id="dateIns" type="date">
    <label>Date of Sub</label><input id="dateSub" type="date">
    <button class="btn" id="downloadPDF">Download PDF</button>
    <button class="btn" id="downloadDOCX">Download DOCX</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.0.0/docx.min.js"></script>

<script>
const el = id => document.getElementById(id);

function formatDateDDMMYYYY(iso){
  if(!iso) return '';
  const [y,m,d] = iso.split('-');
  return `${d}/${m}/${y}`;
}

function updatePreview(){
  el('topRightBlock').innerHTML =
    `<table>
      <tr><td>Experiment NO: ${el('expNo').value}</td></tr>
      <tr><td>${el('subject').value}</td></tr>
      <tr><td>${el('subjectCode').value}</td></tr>
    </table>`;

  // center title text (per-line underline handled by CSS text-decoration)
  el('centerTitle').textContent = el('expTitle').value;

  const members = el('members').value.split(/\r?\n/)
    .map(x => x.trim()).filter(Boolean)
    .map(m => `<tr><td></td><td>${m}</td></tr>`).join('');

  el('middleLeftBlock').innerHTML =
    `<table>
      <tr><td>INSTRUCTED BY</td><td>: ${el('instructor').value}</td></tr>
      <tr><td>GROUP</td><td>: ${el('group').value}</td></tr>
      <tr><td>GROUP MEMBERS</td><td>:</td></tr>
      ${members}
    </table>`;

  el('bottomRightBlock').innerHTML =
    `<table>
      <tr><td>NAME</td><td>: ${el('name').value}</td></tr>
      <tr><td>REG NO</td><td>: ${el('regNo').value}</td></tr>
      <tr><td>COURSE</td><td>: ${el('course').value}</td></tr>
      <tr><td>DATE OF INS</td><td>: ${formatDateDDMMYYYY(el('dateIns').value)}</td></tr>
      <tr><td>DATE OF SUB</td><td>: ${formatDateDDMMYYYY(el('dateSub').value)}</td></tr>
    </table>`;
}

// live preview for input/change
document.querySelectorAll('#form input, #form textarea, #form select')
  .forEach(inp => {
    ['input','change','keyup'].forEach(ev => inp.addEventListener(ev, updatePreview));
  });

updatePreview();

/*
  Download PDF in exact A4:

  Strategy:
  - Temporarily add a "pdf-export" class to <body> to force desktop A4 styles even on small screens.
  - Measure the page element width in pixels (after forcing A4) and pass that to html2canvas so canvas renders at the expected size.
  - Use jsPDF format 'a4' with unit 'mm' to create the pdf with correct dimensions.
  - After saving, remove the temporary class to restore the responsive preview.
*/
document.getElementById('downloadPDF').addEventListener('click', async () => {
  updatePreview();

  const pageEl = document.getElementById('pagePreview');

  // 1) Add class to force desktop/A4 styles
  document.body.classList.add('pdf-export');

  // Allow the browser to apply styles/layout changes before measuring
  await new Promise(requestAnimationFrame);

  // 2) Measure width in pixels of the A4-styled element
  const pxWidth = Math.ceil(pageEl.getBoundingClientRect().width);
  const pxHeight = Math.ceil(pageEl.getBoundingClientRect().height);

  // 3) Prepare html2pdf options - use a reasonably high scale for clarity (2)
  const opt = {
    margin: 0,
    filename: 'cover_page.pdf',
    image: { type: 'jpeg', quality: 1 },
    html2canvas: {
      scale: 2,
      width: pxWidth,
      height: pxHeight,
      windowWidth: pxWidth
    },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
  };

  try {
    // generate and save
    await html2pdf().set(opt).from(pageEl).save();
  } catch (err) {
    console.error('PDF generation failed:', err);
    alert('PDF generation failed. See console for details.');
  } finally {
    // 4) Clean up - remove class so UI returns to normal
    document.body.classList.remove('pdf-export');
  }
});

document.getElementById('downloadDOCX').addEventListener('click', async () => {
  const doc = new docx.Document({
    sections: [{
      children: [ new docx.Paragraph({
        text: document.getElementById('pageInner').innerText,
        spacing: { after: 200 }
      }) ]
    }]
  });
  docx.Packer.toBlob(doc).then(blob => {
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'cover_page.docx';
    a.click();
  });
});
</script>
</body>
</html>